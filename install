#!/bin/bash

function find-str {    
    grep $1 $2 >/dev/null
    if [ $? -eq 0 ]; then
	return $(( 1 ));
    else
	return $(( 0 ));
    fi
}

SHAMAN_DIR_NAME=my-emacs-config
SHAMAN_ROOT=/home/`whoami`/$SHAMAN_DIR_NAME
SHAMAN_BIN=$SHAMAN_ROOT/cache/bin

if [ -d $SHAMAN_ROOT ]; then
    cd $SHAMAN_ROOT
    git reset
    git pull
else
    git clone https://github.com/damon-kwok/my-emacs-config $SHAMAN_ROOT
fi

bkdir=~/emacs-config-backup/`date +%Y-%m-%d@%H-%M-%S`
mkdir -p $bkdir


if [ -f ~/.emacs ]; then
   mv ~/.emacs $bkdir
fi

if [ -f ~/.emacs.d ]; then
   mv -a ~/.emacs.d $bkdir
fi

if [ -f ~/emacs-config ]; then
   mv ~/emacs-config $bkdir
fi
if [ -d ~/emacs-config ]; then
   mv ~/emacs-config $bkdir
fi

cp -a $SHAMAN_ROOT/emacs-config/init.el ~/.emacs 
ln -s $SHAMAN_ROOT/emacs-config ~/emacs-config

# if [ ! -f /usr/bin/shaman ]; then
    # sudo ln -s $SHAMAN_ROOT/shaman /usr/bin/shaman
# fi

find-str "my-emacs-config" ~/.bashrc
if [ $? -eq 0 ]; then
    echo "" >> ~/.bashrc
    # echo "export PATH=$SHAMAN_ROOT:$SHAMAN_BIN:\$PATH" >> ~/.bashrc
    echo "source $SHAMAN_BIN/setup.sh" >> ~/.bashrc
    source ~/.bashrc
fi

find-str "my-emacs-config" ~/.zshrc
if [ $? -eq 0 ]; then
    echo "" >> ~/.zshrc
    # echo "export PATH=$SHAMAN_ROOT:$SHAMAN_BIN:\$PATH" >> ~/.zshrc
    echo "source $SHAMAN_BIN/setup.sh" >> ~/.zshrc
    source ~/.zshrc
fi

